<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Pyodine Client</title>

		<link rel="stylesheet" href="lib/jquery-ui.min.css" />
		<link rel="stylesheet" href="styles.css" />

		<script src="lib/jquery-3.1.1.min.js"></script>
		<script src="lib/jquery-ui-1.12.1.min.js"></script>
		<script src="lib/plotly-1.24.2.min.js"></script>
		<script src="lib/jquery.canvasjs.min.js"></script>
		<script src="pyodine-gui.js"></script>
	</head>
	<body>
		<h1>Pyodine Client</h1>
		<section class="header">
			<p>
				<input id="connect_btn" type="button" value="Connect" />
				to Pyodine server at <input id="host" type="text" value="locarus" />
				(WS port <input id="ws_port" type="number" value="56320" />)
			</p>
			<p>
				<label title="Try this if empty plots are shown.">
					Use server clock instead of local clock <input id="use_server_clock" type="checkbox" />
				</label>
			</p>
			<p>
				Plots show <input id="display_time" type="number" value="120" min="1" max="1000" /> seconds of data.
			</p>
		</section>
		<div class="tabs">
			<ul>
				<li><a href="#tab_logging">Data Logging</a></li>
				<li><a href="#tab_control">Experiment Control</a></li>
				<li><a href="#tab_setup">Setup Parameters</a></li>
			</ul>
			<section id="tab_logging">
				<div class="tabs">
					<ul>
						<li><a href="#tab_adc">ADC Chip</a></li>
					</ul>
					<div id="tab_adc" class="flex_container">
						<div data-title="ADC Channel 0 Voltage" data-ylabel="Voltage in V" class="layout_block plot" id="adc0"></div>
						<div data-title="ADC Channel 1 Voltage" data-ylabel="Voltage in V" class="layout_block plot" id="adc1"></div>
						<div data-title="ADC Channel 2 Voltage" data-ylabel="Voltage in V" class="layout_block plot" id="adc2"></div>
						<div data-title="ADC Channel 3 Voltage" data-ylabel="Voltage in V" class="layout_block plot" id="adc3"></div>
						<div data-title="ADC Channel 4 Voltage" data-ylabel="Voltage in V" class="layout_block plot" id="adc4"></div>
						<div data-title="ADC Channel 5 Voltage" data-ylabel="Voltage in V" class="layout_block plot" id="adc5"></div>
						<div data-title="ADC Channel 6 Voltage" data-ylabel="Voltage in V" class="layout_block plot" id="adc6"></div>
						<div data-title="ADC Channel 7 Voltage" data-ylabel="Voltage in V" class="layout_block plot" id="adc7"></div>
					</div>
				</div>
			</section>
			<section id="tab_control">
				<div class="tabs">
					<ul>
						<li><a href="#tab_osc">Oscillator Supplies</a></li>
						<li><a href="#tab_pii">PII Controllers</a></li>
						<li><a href="#tab_texus">TEXUS Relay</a></li>
					</ul>
					<div id="tab_osc" class="flex_container">
						<div class="layout_block osc">
							<div class="osc_plot"
								data-title="Master Oscillator"
								data-current1="mo_current"
								data-current1-set="mo_current_set"
								data-current2="mo_tec_current"
								data-temp="mo_temp"
								data-temp-set="mo_temp_set"></div>
							<div class="controls">
								<h2>Master Oscillator</h2>
								<p>
									<label>
										Unlock controls
										<input type="checkbox" data-safety-switch=".mo_controls input" />
									</label>
								</p>
								<div class="mo_controls">
									<table>
										<tr>
											<td></td>
											<th>TEC</th>
											<th>LD Driver</th>
										</tr>
										<tr>
											<th>State</th>
											<td class="indicator" data-qty="mo_tec_enabled">N/A</td>
											<td class="indicator" data-qty="mo_enabled">N/A</td>
										</tr>
										<tr>
											<th>Updated</th>
											<td class="update_indicator" data-qty="mo_tec_enabled">Never</td>
											<td class="update_indicator" data-qty="mo_enabled">Never</td>
										</tr>
										<tr>
											<th>Switch</th>
											<td>
												<input type="button" class="command" value="On"
													data-method="switch_tec" data-arguments='["mo", true]' />
												<input type="button" class="command" value="Off"
													data-method="switch_tec" data-arguments='["mo", false]' />
											</td>
											<td>
												<input type="button" class="command" value="On"
													data-method="switch_ld" data-arguments='["mo", true]' />
												<input type="button" class="command" value="Off"
													data-method="switch_ld" data-arguments='["mo", false]' />
											</td>
										</tr>
										<tr>
											<th>Temp OK</th>
											<td class="indicator" data-qty="mo_temp_ok" data-text-true="OK"
												data-text-false="not OK">N/A</td>
										</tr>
										<tr>
											<th>Updated</th>
											<td class="update_indicator" data-qty="mo_temp_ok">Never</td>
										</tr>

									</table>
									<h3>Setpoints</h3>
									<p>
										Temperature:
										<input type="number" class="source" data-qty="mo_temp_raw" step="any" />&thinsp;Â°C
										<input type="button" class="setter" data-qty="mo_temp_raw" value="Set" />
									</p>
									<p>
										Diode Current:
										<input type="number" class="source" data-qty="mo_current" step="any" />&thinsp;mA
										<input type="button" class="setter" data-qty="mo_current" value="Set" />
									</p>
								</div>
							</div>
						</div>
					</div>
					<div id="tab_pii" class="flex_container">
						<div class="layout_block pii">
							<div class="pii_plot" data-unit-name="nu"></div>
							<div class="controls">
								<h2>Frequency Lock</h2>
								<p>
									<label>
										Unlock controls
										<input type="checkbox" data-safety-switch=".nu_controls input" />
									</label>
								</p>
								<div class="nu_controls">
									<table>
										<tr>
											<td></td>
											<th>State</th>
											<th>Updated</th>
											<th>Switch</th>
										</tr>
										<tr>
											<th>Enable Lock</th>
											<td class="indicator" data-qty="nu_lock_enabled">N/A</td>
											<td class="update_indicator" data-qty="nu_lock_enabled">Never</td>
											<td>
												<input type="button" class="command" value="On"
													data-method="switch_lock" data-arguments='["nu", true]' />
												<input type="button" class="command" value="Off"
													data-method="switch_lock" data-arguments='["nu", false]' />
											</td>
										</tr>
										<tr>
											<th>Integrator 1</th>
											<td class="indicator" data-qty="nu_i1_enabled">N/A</td>
											<td class="update_indicator" data-qty="nu_i1_enabled">Never</td>
											<td>
												<input type="button" class="command" value="On"
													data-method="switch_integrator" data-arguments='["nu", 1, true]' />
												<input type="button" class="command" value="Off"
													data-method="switch_integrator" data-arguments='["nu", 1, false]' />
											</td>
										</tr>
										<tr>
											<th>Integrator 2</th>
											<td class="indicator" data-qty="nu_i2_enabled">N/A</td>
											<td class="update_indicator" data-qty="nu_i2_enabled">Never</td>
											<td>
												<input type="button" class="command" value="On"
													data-method="switch_integrator" data-arguments='["nu", 2, true]' />
												<input type="button" class="command" value="Off"
													data-method="switch_integrator" data-arguments='["nu", 2, false]' />
											</td>
										</tr>
										<tr>
											<th>Ramp</th>
											<td class="indicator" data-qty="nu_ramp_enabled">N/A</td>
											<td class="update_indicator" data-qty="nu_ramp_enabled">Never</td>
											<td>
												<input type="button" class="command" value="On"
													data-method="switch_ramp" data-arguments='["nu", true]' />
												<input type="button" class="command" value="Off"
													data-method="switch_ramp" data-arguments='["nu", false]' />
											</td>
										</tr>
									</table>
									<h3>Parameters</h3>
									<p>
										Proportional factor:
										<input type="number" class="source" data-qty="nu_prop" step="any" />&thinsp;mV
										<input type="button" class="setter" data-qty="nu_prop" value="Set" />
									</p>
									<p>
										Value Offset:
										<input type="number" class="source" data-qty="nu_offset" step="any" />&thinsp;mV
										<input type="button" class="setter" data-qty="nu_offset" value="Set" />
									</p>
								</div>
							</div>
						</div>
					</div>
					<div id="tab_texus" class="flex_container">
						<div class="layout_block">
							<h2>Incoming Flags</h2>
							<table id="incoming_flags" class="flags">
								<tr>
									<th>Signal</th>
									<th>State</th>
									<th>Changed</th>
									<th>Updated</th>
								</tr>
								<tr data-flag="liftoff">
									<th class="title">LiftOff</th>
									<td class="indicator">N/A</td>
									<td class="changed">Never</td>
									<td class="updated">Never</td>
								</tr>
								<tr data-flag="microg">
									<th class="title">3-Axis Go</th>
									<td class="indicator">N/A</td>
									<td class="changed">Never</td>
									<td class="updated">Never</td>
								</tr>
								<tr data-flag="tex1">
									<th class="title">TEXUS 1</th>
									<td class="indicator">N/A</td>
									<td class="changed">Never</td>
									<td class="updated">Never</td>
								</tr>
								<tr data-flag="tex2">
									<th class="title">TEXUS 2</th>
									<td class="indicator">N/A</td>
									<td class="changed">Never</td>
									<td class="updated">Never</td>
								</tr>
								<tr data-flag="tex3">
									<th class="title">TEXUS 3</th>
									<td class="indicator">N/A</td>
									<td class="changed">Never</td>
									<td class="updated">Never</td>
								</tr>
								<tr data-flag="tex4">
									<th class="title">TEXUS 4</th>
									<td class="indicator">N/A</td>
									<td class="changed">Never</td>
									<td class="updated">Never</td>
								</tr>
								<tr data-flag="tex5">
									<th class="title">TEXUS 5</th>
									<td class="indicator">N/A</td>
									<td class="changed">Never</td>
									<td class="updated">Never</td>
								</tr>
								<tr data-flag="tex6">
									<th class="title">TEXUS 6</th>
									<td class="indicator">N/A</td>
									<td class="changed">Never</td>
									<td class="updated">Never</td>
								</tr>
							</table>
						</div>
						<div class="layout_block">
							<h2>Outgoing Flags</h2>
							<table id="outgoing_flags" class="flags">
								<tr>
									<th>Signal</th>
									<th>
										Set 
										<label>
											(enable
											<input type="checkbox" data-safety-switch="#outgoing_flags input.switch" />)
										</label>
									</th>
									<th>State</th>
									<th>Changed</th>
									<th>Updated</th>
								</tr>
								<tr class="flag" data-flag="jok1">
									<th class="title">Signal 1</th>
									<td class="set" title="enable above">
										<input class="switch on" disabled type="button" value="On" />
										<input class="switch off" disabled type="button" value="Off" />
									</td>
									<td class="indicator">N/A</td>
									<td class="changed">Never</td>
									<td class="updated">Never</td>
								</tr>
								<tr class="flag" data-flag="jok2">
									<th class="title">Signal 2</th>
									<td class="set" title="enable above">
										<input class="switch on" disabled type="button" value="On" />
										<input class="switch off" disabled type="button" value="Off" />
									</td>
									<td class="indicator">N/A</td>
									<td class="changed">Never</td>
									<td class="updated">Never</td>
								</tr>
								<tr class="flag" data-flag="jok3">
									<th class="title">Signal 3</th>
									<td class="set" title="enable above">
										<input class="switch on" disabled type="button" value="On" />
										<input class="switch off" disabled type="button" value="Off" />
									</td>
									<td class="indicator">N/A</td>
									<td class="changed">Never</td>
									<td class="updated">Never</td>
								</tr>
								<tr class="flag" data-flag="jok4">
									<th class="title">Signal 4</th>
									<td class="set" title="enable above">
										<input class="switch on" disabled type="button" value="On" />
										<input class="switch off" disabled type="button" value="Off" />
									</td>
									<td class="indicator">N/A</td>
									<td class="changed">Never</td>
									<td class="updated">Never</td>
								</tr>
							</table>
						</div>
					</div>
				</div>
				<p>Send arbitrary command:</p>
				<p>
					<input id="send_data" type="text" value='{"data":{"method":"foo", "args":[1, 2, 3]}}' />
					<input id="send_btn" type="button" value="Send" />
				</p>
			</section>
			<section id="tab_setup">
				<h2>AOM and Mixer</h2>
				<p>
					AOM Frequency (currently <span id="aom_freq"></span>&thinsp;MHz):
					<input id="aom_freq_setpoint" type="number" value="150.0" />
					<input type="button" class="setter" value="set" />
				</p>
				<div>
					Offset between AOM and Mixer phase (currently <span id="aom_phase"></span>&thinsp;%):
					<div id="aom_phase_setpoint" class="slider">
						<div class="ui-slider-handle"></div>
					</div>:
					<input type="number" class="gauge" data-source-slider="#aom_phase_setpoint" />
				</div>
			</section>
		</div>
	</body>
</html>
